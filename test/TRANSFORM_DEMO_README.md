# 变换系统演示 - 新系统与Qt的协作

## 概述

这个演示程序展示了新的变换系统如何与Qt的图形框架协作。新系统的核心思想是将每个变换操作（平移、旋转、缩放、斜切）作为独立的对象存储，而不是使用单一的变换矩阵。

## 设计理念

### 1. 分离的变换操作
- 每个变换都是独立的操作对象
- 操作以序列形式存储，可以单独撤销或修改
- 避免了矩阵分解的精度损失

### 2. 保持本地坐标
- 每个图形对象始终保留原始的本地坐标
- 变换是叠加计算的，不影响原始数据
- 多选时每个对象的本地坐标保持独立

### 3. 与Qt的协作方式
- TransformObject：管理变换操作序列
- DemoGraphicsItem：Qt图形项，负责显示
- updateDisplay()：同步新系统与Qt的显示

## 核心组件

### TransformOperation（变换操作基类）
- TranslateOperation：平移
- RotateOperation：旋转
- ScaleOperation：缩放
- ShearOperation：斜切

### TransformObject（变换对象）
- 保持原始本地边界
- 维护变换操作序列
- 提供坐标转换方法
- 计算组合变换矩阵（用于Qt渲染）

### DemoGraphicsItem（Qt图形项）
- 继承自QGraphicsRectItem
- 持有TransformObject引用
- 通过updateDisplay()同步显示

### TransformScene（场景管理）
- 管理多个TransformObject
- 提供批量变换操作
- 处理用户交互

## 使用说明

### 基本操作
1. **添加对象**：Ctrl+R（矩形）、Ctrl+C（圆形）
2. **选择对象**：鼠标点击或拖拽选择框
3. **移动对象**：直接拖拽
4. **删除对象**：Delete键
5. **全选**：Ctrl+A

### 变换操作
1. **平移**：T键或右键菜单
2. **旋转**：R键或右键菜单
3. **缩放**：S键或右键菜单
4. **斜切**：H键或右键菜单
5. **重置**：Ctrl+Z

### 视图控制
1. **缩放**：鼠标滚轮
2. **平移视图**：鼠标中键拖拽
3. **显示信息**：I键或右键菜单

## 优势展示

### 1. 精确的撤销/重做
- 可以撤销特定类型的变换
- 不需要矩阵分解

### 2. 多选本地坐标统一
- 每个对象保持自己的坐标系
- 批量操作时不会混乱

### 3. 变换链可视化
- 可以查看完整的变换操作序列
- 理解变换的叠加过程

### 4. 数值精度
- 避免了矩阵运算的累积误差
- 保持原始数据的完整性

## 编译和运行

```bash
# 使用qmake
qmake transform-demo.pro
make

# 运行
./transform-demo
```

## 扩展性

这个系统设计为可扩展的：
1. 可以轻松添加新的变换类型
2. 支持变换操作的组合和嵌套
3. 可以集成到现有的Qt项目中
4. 逐步替换现有的变换系统

## 与现有系统的对比

| 特性 | 现有系统 | 新系统 |
|------|----------|--------|
| 变换存储 | 单一矩阵 | 操作序列 |
| 撤销/重做 | 需要矩阵分解 | 直接操作 |
| 多选坐标 | 可能混乱 | 完全独立 |
| 数值精度 | 可能有损失 | 保持原始 |
| 扩展性 | 有限 | 高度可扩展 |

这个演示程序展示了新变换系统的强大功能，特别是在处理复杂变换和多选操作时的优势。